<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zyron (Proxy mode)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0a0a0c; --nav-bg:rgba(20,20,23,0.9); --accent:#a855f7;
      --text:#f8fafc; --muted:#94a3b8; --input:#111114; --border:#27272a;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto; background:var(--bg); color:var(--text); overflow:hidden}
    #top-ui{position:relative}
    .tab-strip{display:flex;align-items:flex-end;padding:12px 15px 0 15px;background:var(--bg);gap:4px;height:40px}
    .tab{background:transparent;padding:8px 12px;border-radius:10px 10px 0 0;color:var(--muted);border:1px solid transparent;min-width:140px;display:flex;align-items:center;gap:8px;cursor:pointer}
    .tab.active{background:#1a1a1e;color:var(--text);border-color:var(--border)}
    .navbar{display:flex;align-items:center;height:56px;background:var(--nav-bg);padding:0 20px;gap:16px;border-bottom:1px solid var(--border);backdrop-filter:blur(8px)}
    .nav-button{cursor:pointer;width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--muted)}
    .search-container{flex:1;display:flex;align-items:center;background:var(--input);border-radius:12px;padding:0 12px;border:1px solid var(--border);height:38px}
    input#bar{flex:1;background:transparent;border:none;color:var(--text);padding:8px;font-size:14px;outline:none}
    .frame-container{position:absolute;top:108px;left:0;right:0;bottom:0;background:#000}
    iframe{width:100%;height:100%;border:none;display:none}
    iframe.active{display:block}
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:10000}
    .modal-overlay.show{display:flex}
    .modal-content{background:#111116;padding:20px;border-radius:12px;border:1px solid var(--border);width:420px}
    .setting-btn{width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:#1a1a1e;color:var(--text);cursor:pointer;margin-top:8px}
    .custom-input{width:100%;padding:8px;border-radius:8px;border:1px solid var(--border);background:var(--input);color:var(--text);outline:none}
    #loading-screen{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:var(--bg);z-index:9999}
    .black-hole{width:100px;height:100px;border-radius:50%;background:#000;box-shadow:0 0 40px 10px var(--accent)}
  </style>
</head>
<body>
  <div id="loading-screen"><div class="black-hole"></div></div>

  <div id="top-ui">
    <div class="tab-strip" id="tab-strip">
      <div class="nav-button" onclick="createNewTab()" style="font-size:20px">+</div>
    </div>

    <nav class="navbar">
      <div class="nav-buttons" style="display:flex;gap:8px">
        <div class="nav-button" onclick="goBack()">←</div>
        <div class="nav-button" onclick="goForward()">→</div>
        <div class="nav-button" onclick="reloadPage()">↻</div>
      </div>

      <div class="search-container">
        <input id="bar" placeholder="Search or enter URL" autocomplete="off" />
      </div>

      <div class="nav-buttons" style="display:flex;gap:8px">
        <div class="nav-button" onclick="showSettings()">⚙</div>
        <div class="nav-button" onclick="toggleFullScreen()">⛶</div>
      </div>
    </nav>
  </div>

  <div class="frame-container" id="frame-container">
    <div id="new-tab-ui" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;color:var(--muted)">
      <h1 style="margin:0;font-size:48px">Zyron</h1>
      <p style="margin-top:6px">Open a new tab</p>
    </div>
  </div>

  <div class="modal-overlay" id="settings-modal" onclick="hideSettings()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <h3 style="margin:0;color:var(--accent)">Settings</h3>
      <div style="margin-top:12px">
        <label style="font-size:12px;color:var(--muted);display:block;margin-bottom:6px">Proxy Base URL</label>
        <input id="proxy-base" class="custom-input" placeholder="/proxy" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="setting-btn" onclick="saveProxy()">Save</button>
          <button class="setting-btn" onclick="resetProxy()">Reset</button>
        </div>
        <p style="font-size:12px;color:var(--muted);margin-top:10px">
          Example values:
          <ul style="margin:6px 0 0 18px;color:var(--muted)">
            <li>/proxy (same origin)</li>
            <li>https://your-vercel.app/api/proxy</li>
            <li>https://your-site.netlify.app/.netlify/functions/proxy</li>
            <li>https://your-cloudflare.pages.dev/proxy</li>
          </ul>
        </p>
      </div>
      <button class="setting-btn" style="background:transparent;margin-top:12px" onclick="hideSettings()">Close</button>
    </div>
  </div>

  <script>
    let tabs = [], activeTabId = null;
    const DEFAULT_PROXY_BASE = '/proxy'; // change if you want a different default
    let PROXY_BASE = localStorage.getItem('zyron-proxy-base') || DEFAULT_PROXY_BASE;

    function normalizeProxyBase(b){
      if(!b) return DEFAULT_PROXY_BASE;
      // remove trailing ?url= or trailing slash
      return b.replace(/\\?url=.*$/,'').replace(/\/$/,'');
    }

    function saveProxy(){
      const v = (document.getElementById('proxy-base').value || '').trim();
      PROXY_BASE = normalizeProxyBase(v || DEFAULT_PROXY_BASE);
      localStorage.setItem('zyron-proxy-base', PROXY_BASE);
      alert('Proxy saved: ' + PROXY_BASE);
      hideSettings();
    }
    function resetProxy(){
      PROXY_BASE = DEFAULT_PROXY_BASE;
      localStorage.removeItem('zyron-proxy-base');
      document.getElementById('proxy-base').value = PROXY_BASE;
      alert('Proxy reset to default: ' + PROXY_BASE);
    }

    function showSettings(){ document.getElementById('proxy-base').value = PROXY_BASE; document.getElementById('settings-modal').classList.add('show'); }
    function hideSettings(){ document.getElementById('settings-modal').classList.remove('show'); }

    function showBH(){ document.getElementById('loading-screen').style.display='flex' }
    function hideBH(){ document.getElementById('loading-screen').style.display='none' }

    function createNewTab(){
      const id = Date.now()+Math.random();
      tabs.push({id, url:'', title:'New Tab'});
      const frame = document.createElement('iframe');
      frame.id = 'frame-' + id;
      frame.onload = ()=>{ const t=tabs.find(x=>x.id===id); if(t) t.loading=false; hideBH(); renderTabs(); };
      document.getElementById('frame-container').appendChild(frame);
      switchTab(id);
    }

    function switchTab(id){
      activeTabId=id;
      document.querySelectorAll('iframe').forEach(f=>f.classList.remove('active'));
      const frame=document.getElementById('frame-'+id);
      if(frame) frame.classList.add('active');
      const tab=tabs.find(t=>t.id===id);
      document.getElementById('bar').value=tab.url||'';
      document.getElementById('new-tab-ui').style.display = frame && frame.src ? 'none' : 'flex';
      renderTabs();
    }

    function renderTabs(){
      const strip=document.getElementById('tab-strip');
      const addBtn=strip.querySelector('.nav-button');
      strip.querySelectorAll('.tab').forEach(t=>t.remove());
      tabs.forEach(tab=>{
        const tabEl=document.createElement('div');
        tabEl.className='tab '+(tab.id===activeTabId?'active':'');
        tabEl.onclick = ()=>switchTab(tab.id);
        tabEl.innerHTML = `<span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${tab.title}</span><button style="background:none;border:none;color:inherit;cursor:pointer" onclick="closeTab(event,${tab.id})">×</button>`;
        strip.insertBefore(tabEl, addBtn);
      });
    }

    function closeTab(e,id){ e.stopPropagation(); if(tabs.length===1) return; tabs = tabs.filter(t=>t.id!==id); const el=document.getElementById('frame-'+id); if(el) el.remove(); if(activeTabId===id) switchTab(tabs[0].id); else renderTabs(); }

    function goBack(){ try{ document.getElementById('frame-'+activeTabId).contentWindow.history.back(); }catch(e){} }
    function goForward(){ try{ document.getElementById('frame-'+activeTabId).contentWindow.history.forward(); }catch(e){} }
    function reloadPage(){ try{ const frame=document.getElementById('frame-'+activeTabId); if(frame && frame.src) frame.contentWindow.location.reload(); }catch(e){ if(frame) frame.src = frame.src; } }

    function nav(){
      const val=document.getElementById('bar').value.trim();
      if(!val) return;
      document.activeElement.blur();
      showBH();
      let url = (val.includes('.') && !val.includes(' ')) ? (val.startsWith('http') ? val : 'https://' + val) : 'https://search.brave.com/search?q=' + encodeURIComponent(val);
      const tab = tabs.find(t=>t.id===activeTabId);
      if(tab){ tab.url = url; tab.title = url.split('/')[2] || url; }
      // build proxied URL: PROXY_BASE + '?url=' + encodeURIComponent(url)
      const proxyPrefix = PROXY_BASE;
      const proxied = proxyPrefix + '?url=' + encodeURIComponent(url);
      document.getElementById('frame-'+activeTabId).src = proxied;
      document.getElementById('new-tab-ui').style.display = 'none';
      renderTabs();
    }

    function toggleFullScreen(){ if(!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }

    window.onload = ()=>{
      // init
      if(!tabs.length) createNewTab();
      hideBH();
      document.getElementById('bar').onkeydown = (e)=>{ if(e.key==='Enter') nav(); };
    };
  </script>
</body>
</html>
